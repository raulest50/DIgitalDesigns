----------------------------------------------------------------------------------
-- Company: 
-- Engineer: 
-- 
-- Create Date: 12.11.2018 12:32:36
-- Design Name: 
-- Module Name: SineWave100s - Behavioral
-- Project Name: 
-- Target Devices: 
-- Tool Versions: 
-- Description: 
-- 
-- Dependencies: 
-- 
-- Revision:
-- Revision 0.01 - File Created
-- Additional Comments:
-- 
----------------------------------------------------------------------------------


library IEEE;
use IEEE.STD_LOGIC_1164.ALL;
use IEEE.NUMERIC_STD.ALL;
USE IEEE.STD_LOGIC_UNSIGNED.ALL;

-- Uncomment the following library declaration if instantiating
-- any Xilinx leaf cells in this code.
--library UNISIM;
--use UNISIM.VComponents.all;

entity SineWave100s is
    Port ( clk : in STD_LOGIC;
           resetn : in STD_LOGIC;
           enable : in STD_LOGIC;
           sinw : out STD_LOGIC_VECTOR (15 downto 0));
end SineWave100s;

architecture Behavioral of SineWave100s is

    type rom is array (0 to 99) of std_logic_vector(15 downto 0);
    
    -- tabla de 12 bits 100 muestras de señal sinusoidal.
    constant tab : rom :=(
    0 => B"0000000000000000",
    1 => B"0000000000101001",
    2 => B"0000000001010010",
    3 => B"0000000001111011",
    4 => B"0000000010100011",
    5 => B"0000000011001010",
    6 => B"0000000011110001",
    7 => B"0000000100010111",
    8 => B"0000000100111100",
    9 => B"0000000101011111",
    10 => B"0000000110000001",
    11 => B"0000000110100010",
    12 => B"0000000111000000",
    13 => B"0000000111011101",
    14 => B"0000000111111001",
    15 => B"0000001000010010",
    16 => B"0000001000101001",
    17 => B"0000001000111110",
    18 => B"0000001001010001",
    19 => B"0000001001100001",
    20 => B"0000001001101111",
    21 => B"0000001001111010",
    22 => B"0000001010000011",
    23 => B"0000001010001010",
    24 => B"0000001010001110",
    25 => B"0000001010001111",
    26 => B"0000001010001110",
    27 => B"0000001010001010",
    28 => B"0000001010000011",
    29 => B"0000001001111010",
    30 => B"0000001001101111",
    31 => B"0000001001100001",
    32 => B"0000001001010001",
    33 => B"0000001000111110",
    34 => B"0000001000101001",
    35 => B"0000001000010010",
    36 => B"0000000111111001",
    37 => B"0000000111011101",
    38 => B"0000000111000000",
    39 => B"0000000110100010",
    40 => B"0000000110000001",
    41 => B"0000000101011111",
    42 => B"0000000100111100",
    43 => B"0000000100010111",
    44 => B"0000000011110001",
    45 => B"0000000011001010",
    46 => B"0000000010100011",
    47 => B"0000000001111011",
    48 => B"0000000001010010",
    49 => B"0000000000101001",
    50 => B"0000000000000000",
    51 => B"1111111111010111",
    52 => B"1111111110101110",
    53 => B"1111111110000101",
    54 => B"1111111101011101",
    55 => B"1111111100110110",
    56 => B"1111111100001111",
    57 => B"1111111011101001",
    58 => B"1111111011000100",
    59 => B"1111111010100001",
    60 => B"1111111001111111",
    61 => B"1111111001011110",
    62 => B"1111111001000000",
    63 => B"1111111000100011",
    64 => B"1111111000000111",
    65 => B"1111110111101110",
    66 => B"1111110111010111",
    67 => B"1111110111000010",
    68 => B"1111110110101111",
    69 => B"1111110110011111",
    70 => B"1111110110010001",
    71 => B"1111110110000110",
    72 => B"1111110101111101",
    73 => B"1111110101110110",
    74 => B"1111110101110010",
    75 => B"1111110101110001",
    76 => B"1111110101110010",
    77 => B"1111110101110110",
    78 => B"1111110101111101",
    79 => B"1111110110000110",
    80 => B"1111110110010001",
    81 => B"1111110110011111",
    82 => B"1111110110101111",
    83 => B"1111110111000010",
    84 => B"1111110111010111",
    85 => B"1111110111101110",
    86 => B"1111111000000111",
    87 => B"1111111000100011",
    88 => B"1111111001000000",
    89 => B"1111111001011110",
    90 => B"1111111001111111",
    91 => B"1111111010100001",
    92 => B"1111111011000100",
    93 => B"1111111011101001",
    94 => B"1111111100001111",
    95 => B"1111111100110110",
    96 => B"1111111101011101",
    97 => B"1111111110000101",
    98 => B"1111111110101110",
    99 => B"1111111111010111"
    );
    
    signal count : unsigned(7 downto 0);

begin

    contar : process(clk)
    begin
    if resetn = '0' then -- reset activo bajo
        count <= "00000000";
    else
        if rising_edge(clk) then   
            if enable = '1' then
                count <= count + 1;
            end if;
                if count >= 99 then
                    count <= "00000000"; -- se regresa la posicion inicial de la tabla
                end if;
        end if;
    end if;
    
    -- los datos de la tabla representan una sinusoidal con 12 bits pero el modelo de la carga espera una señal de corriente de 16 bits
    -- razon por la cual se concatenan 4 bits en el lado mas significativos para la señal de salida.
    
    if enable = '1' then
        sinw <= tab(to_integer(count));
    else
        sinw <= "0000000000000000";
    end if;
    end process;

end Behavioral;
